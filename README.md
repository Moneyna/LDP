This is the official PyTorch codes for the paper  
LDP-SR: A Lightweight Diffusion Plug-in for Single Image Super-Resolution


## Train the model

### Preparation

#### Dataset

Please prepare the training and testing data follow descriptions in the main paper and supplementary material. 

Training datasets are generated by basicsr/data/degradation_train_dataset.py
Synthetic datasets are generated by basicsr/create_degradation_dataset.py


### Train LDP-SR model

```
python basicsr/train.py -opt options/train_LDPSR.yml
```
The arch file is placed at basicsr/archs/LDPSR_arch.py

### FineTune existing SR models with LDP-SR
```
# FeMaSR
python basicsr/train.py -opt options/fineTune_syn_femasr_V7.yaml

# SwinIR
python basicsr/train.py -opt options/fineTune_syn_SwinIR_V7.yaml

# MambaIR
python basicsr/train.py -opt options/fineTune_syn_MambaIR_V7.yaml
```
### Diffusion posterior sampling with LDP-SR.
```
# LDM
python test_ldm.py   -i /data/stablesr/DIV2K_crop128/LR/x4/ -igt /data/stablesr/DIV2K_crop128/HR/  --num-sampling-steps 50 --output ./ldm/syn/DIV2K --mode FT --dps_scale 1 --strength 0.2 --save_imgs

# SD 2.1
test_stableD.py   -i /data/stablesr/DIV2K_crop128/LR/x4/ -igt /data/stablesr/DIV2K_crop128/HR/  --num-sampling-steps 50 --output ./ldm/syn/DIV2K --mode FT --dps_scale 1 --strength 0.2 --save_imgs
```

## License

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.

## Acknowledgement

This project is based on [BasicSR](https://github.com/xinntao/BasicSR), [diffuers](https://github.com/huggingface/diffusers.git), [FeMaSR](https://github.com/chaofengc/FeMaSR), [SwinIR](https://github.com/JingyunLiang/SwinIR.git), [MambaIR](https://github.com/csguoh/MambaIR.git)
